<html th:replace="~{layout/baseTemplate :: html}" xmlns:th="http://www.thymeleaf.org">
<div th:fragment="contenido">
    <main class="p-3 container border border-solid">
        <h1>Editar coleccion</h1>
        <form class="d-flex flex-column row-gap-5" ,
            th:action="@{/colecciones/{coleccionId}/actualizar (coleccionId=${coleccionId})}" th:object="${coleccion}"
            method="post" onSubmit="procesarSubmit(event)">
            <div class="mb-3">
                <label for="titulo_coleccion" class="form-label">Titulo</label>
                <input id="titulo_coleccion" type="text" class="form-control" placeholder="Ingrese titulo" required
                    th:field="*{titulo}">
            </div>
            <div class="mb-3">
                <label class="form-label">Descripcion</label>
                <textarea class="form-control" placeholder="Ingrese descripcion de la coleccion" required
                    th:field="*{descripcion}"></textarea>
            </div>

            <div class="mb-3">
                <div class="row">
                    <div class="col-12">
                        <label class="form-label">Elija algoritmo</label>
                        <select th:field="*{algoritmo}" class="form-select">
                            <option value="" selected>Algoritmo</option>
                            <option value="ABSOLUTO">Consenso Abosluto</option>
                            <option value="MAYORIA_SIMPLE">Consenso Mayoria simple</option>
                            <option value="MULTIPLES_MENCIONES">Consenso Multiples menciones
                            </option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="mt-5">
                <h1>Criterios de pertenencia</h1>

                <div class="d-flex gap-2 align-items-center mb-3">
                    <select id="tipoFiltro" class="form-select">
                        <option value="">Seleccione un tipo</option>
                        <option value="FILTRO_CATEGORIA">Categoría</option>
                        <option value="FILTRO_FECHA_ACONTECIMIENTO">Fecha Acontecimiento</option>
                        <option value="FILTRO_FECHA_REPORTE">Fecha Reporte</option>
                        <option value="FILTRO_PROVINCIA">Provincia</option>
                        <option value="FILTRO_DEPARTAMENTO">Departamento</option>
                        <option value="FILTRO_MUNICIPIO">Municipio</option>
                        <option value="FILTRO_FUENTE">Tipo de Fuente</option>
                    </select>

                    <button type="button" class="btn btn-success" onclick="agregarFiltro()">Agregar filtro</button>
                </div>

                <div id="lista-filtros">
                    <div class="filtro-item d-flex flex-row mb-4 p-2 align-items-center justify-content-start gap-3"
                         th:each="criterio, iterStat : *{criterios}">
                        <select class="form-select" aria-label="elegir-filtro"
                                th:field="*{criterios[__${iterStat.index}__].tipoCriterio}"
                                th:value="*{criterios[__${iterStat.index}__].tipoCriterio}"
                        >
                            <option value="FILTRO_CATEGORIA">Categoría</option>
                            <option value="FILTRO_FECHA_ACONTECIMIENTO">Fecha Acontecimiento</option>
                            <option value="FILTRO_FECHA_REPORTE">Fecha Reporte</option>
                            <option value="FILTRO_PROVINCIA">Provincia</option>
                            <option value="FILTRO_DEPARTAMENTO">Departamento</option>
                            <option value="FILTRO_MUNICIPIO">Municipio</option>
                            <option value="FILTRO_FUENTE">Tipo de Fuente</option>
                        </select>
                        <div th:switch="${criterio.tipoCriterio}">
                            <div th:case="'FILTRO_FECHA_ACONTECIMIENTO'">
                                <input type="date" disabled th:value="${criterio.fechaInicio}" class="form-control"/>
                                <input type="date" disabled th:value="${criterio.fechaFin}" class="form-control"/>
                                <input type="hidden" th:name="|criterios[${iterStat.index}].fechaInicio|" th:value="${criterio.fechaInicio}">
                                <input type="hidden" th:name="|criterios[${iterStat.index}].fechaFin|" th:value="${criterio.fechaFin}">
                            </div>
                            <div th:case="'FILTRO_FECHA_REPORTE'">
                                <input type="date" disabled th:value="${criterio.fechaInicio}" class="form-control"/>
                                <input type="date" disabled th:value="${criterio.fechaFin}" class="form-control"/>
                                <input type="hidden" th:name="|criterios[${iterStat.index}].fechaInicio|" th:value="${criterio.fechaInicio}">
                                <input type="hidden" th:name="|criterios[${iterStat.index}].fechaFin|" th:value="${criterio.fechaFin}">

                            </div>
                            <div th:case="'FILTRO_FUENTE'">
                                <input type="text" disabled th:value="${criterio.tipoFuente}" class="form-control"/>
                                <input type="hidden" th:name="|criterios[${iterStat.index}].tipoFuente|" th:value="${criterio.tipoFuente}">
                            </div>
                            <div th:case="*">
                                <input type="text" disabled th:value="${criterio.valor}" class="form-control"/>
                                <input type="hidden" th:name="|criterios[${iterStat.index}].valor|" th:value="${criterio.valor}">

                            </div>
                        </div>
                        <button
                                th:data-tipo-criterio="${criterio.getTipoCriterio()}"
                                type="button" class="btn btn-danger" th:onclick="eliminarFiltro(this)">Eliminar</button>
                </div>
            </div>

            <div class="mt-5">
                <h1>Fuentes</h1>
                <button type="button" class="btn btn-success" onclick="agregarFuente(this)">Agregar</button>
                <span id="errorMsg" style="color:red; display:none;"></span>
                <div id="fuentes-container">
                    <div class="fuente-item d-flex flex-row mb-4 p-2 align-items-center justify-content-start gap-3"
                        th:each="fuente, iterStat : *{fuentes}">
                        <select class="form-select" aria-label="elegir-fuente"
                            th:field="*{fuentes[__${iterStat.index}__].tipoFuente}" onchange=cambiarInput(this)>
                            <option selected value="">Tipo de fuente</option>
                            <option value="ESTATICA">Estatica</option>
                            <option value="DINAMICA">Dinamica</option>
                            <option value="PROXY_METAMAPA">Proxy api</option>
                        </select>
                        <input class="form-control fuente-input" type="text" placeholder="URL"
                            th:field="*{fuentes[__${iterStat.index}__].url}" required hidden>
                        <button type="button" class="btn btn-danger" onclick="eliminarFuente(this)">Eliminar</button>
                    </div>
                </div>
            </div>

            <div id="mensajeErrorGlobal" class="alert alert-danger mt-4" role="alert" style="display: none;">
            </div>
            <div class="mt-5">
                <button id="submit-button" type="submit" class="btn btn-dark">Finalizar</button>
            </div>
        </form>

    </main>
    <script src="/js/crear-coleccion.js"></script>
</div>

</html>